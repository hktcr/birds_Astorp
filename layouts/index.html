{{ define "main" }}
<!-- Professionell mjuk startsida -->
<section class="home-hero">
    <div class="home-container">
        <!-- Stor logga centrerad -->
        <div class="hero-logo">
            <img src="{{ `images/logo-fagelaret-2026.png` | relURL }}" alt="Ett år med fåglar — Åstorp 2026">
        </div>

        <!-- Progressbar som termometer -->
        <div class="hero-progress">
            <div class="progress-header">
                <span class="progress-label">Årslista</span>
                <span class="progress-count"><span id="species-count">—</span> av 150 arter</span>
            </div>
            <div class="thermometer">
                <div class="thermometer-scale">
                    <span class="scale-mark" style="left: 0%">0</span>
                    <span class="scale-mark" style="left: 33%">50</span>
                    <span class="scale-mark" style="left: 66%">100</span>
                    <span class="scale-mark" style="left: 100%">150</span>
                </div>
                <div class="thermometer-bar">
                    <div class="thermometer-fill" id="progress-fill"></div>
                </div>
            </div>
            <div class="latest-species" id="latest-species"></div>
        </div>

        <!-- Observationsspår / Tidslinje -->
        <div class="observation-trail">
            <h2 class="trail-title">Observationsspår</h2>
            <div class="trail-timeline" id="trail-timeline">
                <!-- Fylls av JavaScript -->
            </div>
        </div>

        <!-- Navigeringsalternativ -->
        <nav class="hero-nav">
            <a href="{{ `arslista/` | relURL }}" class="nav-card">
                <span class="nav-label">Artlista</span>
                <span class="nav-desc">Alla observerade arter</span>
            </a>
            <a href="{{ `karta/` | relURL }}" class="nav-card">
                <span class="nav-label">Karta</span>
                <span class="nav-desc">Var arterna hittats</span>
            </a>
            <a href="{{ `arkiv/` | relURL }}" class="nav-card">
                <span class="nav-label">Notiser</span>
                <span class="nav-desc">Berättelser från fält</span>
            </a>
        </nav>
    </div>
</section>
{{ end }}

{{ define "scripts" }}
<script>
    const YEAR_GOAL = 150;

    fetch('{{ `data/checklist-2026.json` | relURL }}')
        .then(r => r.json())
        .then(data => {
            const uniqueSpecies = new Set(data.observations.map(o => o.species));
            const speciesCount = uniqueSpecies.size;

            document.getElementById('species-count').textContent = speciesCount;

            const percentage = (speciesCount / YEAR_GOAL) * 100;
            const fill = document.getElementById('progress-fill');
            fill.style.width = Math.min(percentage, 100) + '%';

            // Dynamisk färg: klarare gul (hue 50) → klarare grön (hue 130)
            const hue = 50 + (percentage / 100) * 80;
            const saturation = 90;
            const lightness = 55;
            fill.style.backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`;

            // Visa senaste kryssade art (sista i arrayen = senast tillagd)
            if (data.observations.length > 0) {
                const latest = data.observations[data.observations.length - 1];
                const latestEl = document.getElementById('latest-species');
                latestEl.innerHTML = `<span class="latest-label">Senast kryssad:</span> <strong>${latest.species}</strong> <span class="latest-meta">(${latest.location}, ${new Date(latest.date).toLocaleDateString('sv-SE', { day: 'numeric', month: 'short' })})</span>`;
            }

            // Bygg observationsspår (tidslinje)
            const byDate = {};
            data.observations.forEach(obs => {
                if (!byDate[obs.date]) {
                    byDate[obs.date] = { species: [], locations: new Set() };
                }
                byDate[obs.date].species.push(obs.species);
                byDate[obs.date].locations.add(obs.location);
            });

            const dates = Object.keys(byDate).sort((a, b) => new Date(b) - new Date(a));
            const trailEl = document.getElementById('trail-timeline');

            trailEl.innerHTML = dates.map((date, i) => {
                const info = byDate[date];
                const dateObj = new Date(date);
                const day = dateObj.getDate();
                const month = dateObj.toLocaleDateString('sv-SE', { month: 'short' });
                const locations = [...info.locations].join(', ');
                const isLast = i === dates.length - 1;

                return `
                    <div class="trail-item ${i === 0 ? 'trail-item-latest' : ''}">
                        <div class="trail-line ${isLast ? 'trail-line-end' : ''}"></div>
                        <div class="trail-dot"></div>
                        <div class="trail-content">
                            <div class="trail-date">${day} ${month}</div>
                            <div class="trail-species">${info.species.join(', ')}</div>
                            <div class="trail-location">${locations}</div>
                        </div>
                    </div>
                `;
            }).join('');
        })
        .catch(console.error);
</script>
{{ end }}